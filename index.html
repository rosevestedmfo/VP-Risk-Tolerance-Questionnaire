<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Risk Tolerance Questionnaire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.5;
      padding: 1.5rem;
      max-width: 900px;
      margin: 0 auto;
      background-color: #f7f7f7;
    }
    h2, h3 {
      margin-top: 1.5rem;
    }
    fieldset {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      background-color: #fff;
    }
    legend {
      font-weight: bold;
      padding: 0 0.25rem;
    }
    label {
      display: block;
      margin: 0.25rem 0;
    }
    #scoreSummary {
      background-color: #fff;
    }
    button[type="submit"] {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
<form id="riskForm">
  <h2>Risk Tolerance Questionnaire</h2>

  <!-- CLIENT INFORMATION -->
  <fieldset>
    <legend>CLIENT INFORMATION</legend>
    <label>
      Primary Client Name:
      <input type="text" name="primaryClientName" required>
    </label>
    <label>
      Co-Client/Spouse Name:
      <input type="text" name="coClientName">
    </label>
    <label>
      Date:
      <input type="date" name="date" required>
    </label>
    <label>
      Advisor:
      <input type="text" name="advisorName" required>
    </label>
  </fieldset>

  <hr>

  <!-- SECTION A -->
  <h3>SECTION A: FINANCIAL CAPACITY (30 points possible)</h3>

  <fieldset>
    <legend>
      A1. What is your investment time horizon for the majority of these funds?
    </legend>
    <label>
      <input type="radio" name="A1" value="0" required>
      Less than 2 years (0 points)
    </label>
    <label>
      <input type="radio" name="A1" value="2">
      2–5 years (2 points)
    </label>
    <label>
      <input type="radio" name="A1" value="4">
      5–10 years (4 points)
    </label>
    <label>
      <input type="radio" name="A1" value="6">
      10–20 years (6 points)
    </label>
    <label>
      <input type="radio" name="A1" value="8">
      More than 20 years (8 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      A2. What percentage of your portfolio do you expect to need for liquidity in the next 5 years?
    </legend>
    <label>
      <input type="radio" name="A2" value="0" required>
      More than 50% (0 points)
    </label>
    <label>
      <input type="radio" name="A2" value="1">
      25–50% (1 point)
    </label>
    <label>
      <input type="radio" name="A2" value="3">
      10–25% (3 points)
    </label>
    <label>
      <input type="radio" name="A2" value="5">
      5–10% (5 points)
    </label>
    <label>
      <input type="radio" name="A2" value="7">
      Less than 5% (7 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      A3. How stable is your primary income source?
    </legend>
    <label>
      <input type="radio" name="A3" value="0" required>
      Very unstable/unemployed (0 points)
    </label>
    <label>
      <input type="radio" name="A3" value="2">
      Unstable (commission, contract work) (2 points)
    </label>
    <label>
      <input type="radio" name="A3" value="3">
      Somewhat stable (3 points)
    </label>
    <label>
      <input type="radio" name="A3" value="5">
      Stable salary (5 points)
    </label>
    <label>
      <input type="radio" name="A3" value="7">
      Very stable (tenured, government) + other income sources (7 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      A4. What is your current debt-to-income ratio (excluding mortgage)?
    </legend>
    <label>
      <input type="radio" name="A4" value="0" required>
      More than 25% (0 points)
    </label>
    <label>
      <input type="radio" name="A4" value="1">
      15–25% (1 point)
    </label>
    <label>
      <input type="radio" name="A4" value="3">
      10–15% (3 points)
    </label>
    <label>
      <input type="radio" name="A4" value="5">
      5–10% (5 points)
    </label>
    <label>
      <input type="radio" name="A4" value="8">
      Less than 5% or debt-free (8 points)
    </label>
  </fieldset>

  <hr>

  <!-- SECTION B -->
  <h3>SECTION B: RISK TOLERANCE (40 points possible)</h3>

  <fieldset>
    <legend>
      B1. During the 2008 financial crisis, the stock market lost approximately 37%. If you had
      owned a diversified stock portfolio then, what would you have done?
    </legend>
    <label>
      <input type="radio" name="B1" value="0" required>
      Sold everything immediately to avoid further losses (0 points)
    </label>
    <label>
      <input type="radio" name="B1" value="3">
      Sold some to reduce my risk exposure (3 points)
    </label>
    <label>
      <input type="radio" name="B1" value="7">
      Held on and did nothing (7 points)
    </label>
    <label>
      <input type="radio" name="B1" value="10">
      Bought more while prices were low (10 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      B2. You invest $100,000 today. What would you expect this investment to be worth in 10 years?
    </legend>
    <label>
      <input type="radio" name="B2" value="2" required>
      $100,000–120,000 (I want to preserve capital) (2 points)
    </label>
    <label>
      <input type="radio" name="B2" value="4">
      $120,000–160,000 (Steady growth is important) (4 points)
    </label>
    <label>
      <input type="radio" name="B2" value="6">
      $160,000–220,000 (I want good growth) (6 points)
    </label>
    <label>
      <input type="radio" name="B2" value="8">
      $220,000–300,000 (I want high growth) (8 points)
    </label>
    <label>
      <input type="radio" name="B2" value="10">
      More than $300,000 (Maximum growth is my priority) (10 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      B3. In any given year, what would be the maximum loss you could tolerate on your total
      portfolio before you would want to change your strategy?
    </legend>
    <label>
      <input type="radio" name="B3" value="0" required>
      Any loss would concern me (0 points)
    </label>
    <label>
      <input type="radio" name="B3" value="2">
      5% loss (2 points)
    </label>
    <label>
      <input type="radio" name="B3" value="4">
      10% loss (4 points)
    </label>
    <label>
      <input type="radio" name="B3" value="6">
      15% loss (6 points)
    </label>
    <label>
      <input type="radio" name="B3" value="8">
      20% loss (8 points)
    </label>
    <label>
      <input type="radio" name="B3" value="10">
      More than 25% loss (10 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      B4. Imagine your portfolio lost 20% of its value in the first year. What best describes your
      likely reaction?
    </legend>
    <label>
      <input type="radio" name="B4" value="0" required>
      I would be devastated and sell everything (0 points)
    </label>
    <label>
      <input type="radio" name="B4" value="2">
      I would be very concerned and sell most investments (2 points)
    </label>
    <label>
      <input type="radio" name="B4" value="5">
      I would be worried but probably hold on (5 points)
    </label>
    <label>
      <input type="radio" name="B4" value="8">
      I would stay calm and stick to my plan (8 points)
    </label>
    <label>
      <input type="radio" name="B4" value="10">
      I would see it as a buying opportunity (10 points)
    </label>
  </fieldset>

  <hr>

  <!-- SECTION C -->
  <h3>SECTION C: INVESTMENT EXPERIENCE &amp; KNOWLEDGE (15 points possible)</h3>

  <fieldset>
    <legend>
      C1. How would you describe your investment experience?
    </legend>
    <label>
      <input type="radio" name="C1" value="0" required>
      No experience (0 points)
    </label>
    <label>
      <input type="radio" name="C1" value="1">
      Limited experience (savings accounts, CDs) (1 point)
    </label>
    <label>
      <input type="radio" name="C1" value="3">
      Some experience (mutual funds, basic stocks) (3 points)
    </label>
    <label>
      <input type="radio" name="C1" value="5">
      Considerable experience (diverse portfolio, 5+ years) (5 points)
    </label>
    <label>
      <input type="radio" name="C1" value="5">
      Extensive experience (complex strategies, 10+ years) (5 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      C2. How well do you understand the relationship between risk and return?
    </legend>
    <label>
      <input type="radio" name="C2" value="0" required>
      I don't understand it (0 points)
    </label>
    <label>
      <input type="radio" name="C2" value="2">
      I have a basic understanding (2 points)
    </label>
    <label>
      <input type="radio" name="C2" value="4">
      I understand it fairly well (4 points)
    </label>
    <label>
      <input type="radio" name="C2" value="5">
      I understand it very well (5 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      C3. Have you ever experienced a significant investment loss (more than 10%)?
    </legend>
    <label>
      <input type="radio" name="C3" value="0" required>
      No, and it would devastate me (0 points)
    </label>
    <label>
      <input type="radio" name="C3" value="2">
      No, but I think I could handle it (2 points)
    </label>
    <label>
      <input type="radio" name="C3" value="1">
      Yes, and I panicked and sold (1 point)
    </label>
    <label>
      <input type="radio" name="C3" value="4">
      Yes, but I held on and recovered (4 points)
    </label>
    <label>
      <input type="radio" name="C3" value="5">
      Yes, and I bought more at lower prices (5 points)
    </label>
  </fieldset>

  <hr>

  <!-- SECTION D -->
  <h3>SECTION D: BEHAVIORAL FACTORS (15 points possible)</h3>

  <fieldset>
    <legend>
      D1. When making investment decisions, which statement best describes you?
    </legend>
    <label>
      <input type="radio" name="D1" value="0" required>
      I need guarantees and certainty (0 points)
    </label>
    <label>
      <input type="radio" name="D1" value="2">
      I prefer low risk with modest returns (2 points)
    </label>
    <label>
      <input type="radio" name="D1" value="4">
      I want balanced growth with some risk (4 points)
    </label>
    <label>
      <input type="radio" name="D1" value="6">
      I'm comfortable with higher risk for better returns (6 points)
    </label>
    <label>
      <input type="radio" name="D1" value="7">
      I seek maximum returns regardless of risk (7 points)
    </label>
  </fieldset>

  <fieldset>
    <legend>
      D2. How do you typically react to market volatility in the news?
    </legend>
    <label>
      <input type="radio" name="D2" value="0" required>
      I get very anxious and want to make changes (0 points)
    </label>
    <label>
      <input type="radio" name="D2" value="2">
      I worry but usually don't act (2 points)
    </label>
    <label>
      <input type="radio" name="D2" value="4">
      I pay attention but stay calm (4 points)
    </label>
    <label>
      <input type="radio" name="D2" value="6">
      I largely ignore short-term market news (6 points)
    </label>
    <label>
      <input type="radio" name="D2" value="8">
      I look for opportunities during volatile times (8 points)
    </label>
  </fieldset>

  <hr>

  <!-- SCORE ADJUSTMENTS -->
  <h3>SCORE ADJUSTMENTS</h3>
  <p>Adjustment Factors:</p>
  <label>
    <input type="checkbox" name="ageOver65">
    Age over 65: Subtract 5 points
  </label>
  <label>
    <input type="checkbox" name="approachingRetirement">
    Approaching retirement (within 5 years): Subtract 10 points
  </label>
  <label>
    <input type="checkbox" name="inheritanceWindfall">
    Large inheritance/windfall: Add 5 points
  </label>
  <label>
    <input type="checkbox" name="singleIncome">
    Single income household: Subtract 5 points
  </label>
  <label>
    <input type="checkbox" name="pensionIncome">
    Pension/guaranteed income: Add 5 points
  </label>

  <hr>

  <!-- CLIENT-FACING SCORE SUMMARY -->
  <div id="scoreSummary" style="padding:0.5rem; border:1px solid #ccc; margin-bottom:1rem;">
    <p><strong>Preliminary Risk Score:</strong> <span id="scoreDisplay">–</span> / 100</p>
    <p><strong>Risk Profile:</strong> <span id="profileDisplay">–</span></p>
  </div>

  <button type="submit">Submit Questionnaire</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const FLOW_URL = "https://defaultdae70c725f0f45a4968a73b35b4f32.7a.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/7398cb55214c4b1b828a81135f8ae0f4/triggers/manual/paths/invoke?api-version=1";

  function getRiskProfile(score) {
    if (score <= 25) return "Conservative";
    if (score <= 45) return "Moderate Conservative";
    if (score <= 65) return "Moderate";
    if (score <= 85) return "Moderate Aggressive";
    return "Aggressive";
  }

  function getRadioValue(form, name) {
    const field = form.querySelector('input[name="' + name + '"]:checked');
    return field ? parseInt(field.value, 10) : 0;
  }

  function calculateScores(form) {
    const A1 = getRadioValue(form, "A1");
    const A2 = getRadioValue(form, "A2");
    const A3 = getRadioValue(form, "A3");
    const A4 = getRadioValue(form, "A4");

    const B1 = getRadioValue(form, "B1");
    const B2 = getRadioValue(form, "B2");
    const B3 = getRadioValue(form, "B3");
    const B4 = getRadioValue(form, "B4");

    const C1 = getRadioValue(form, "C1");
    const C2 = getRadioValue(form, "C2");
    const C3 = getRadioValue(form, "C3");

    const D1 = getRadioValue(form, "D1");
    const D2 = getRadioValue(form, "D2");

    const sectionA = A1 + A2 + A3 + A4;
    const sectionB = B1 + B2 + B3 + B4;
    const sectionC = C1 + C2 + C3;
    const sectionD = D1 + D2;

    const rawTotal = sectionA + sectionB + sectionC + sectionD;

    let adjustments = 0;
    if (form.ageOver65 && form.ageOver65.checked) adjustments -= 5;
    if (form.approachingRetirement && form.approachingRetirement.checked) adjustments -= 10;
    if (form.inheritanceWindfall && form.inheritanceWindfall.checked) adjustments += 5;
    if (form.singleIncome && form.singleIncome.checked) adjustments -= 5;
    if (form.pensionIncome && form.pensionIncome.checked) adjustments += 5;

    const finalScore = rawTotal + adjustments;
    const finalScoreClamped = Math.max(0, Math.min(100, finalScore));
    const riskProfile = getRiskProfile(finalScoreClamped);

    return {
      A1, A2, A3, A4,
      B1, B2, B3, B4,
      C1, C2, C3,
      D1, D2,
      sectionA,
      sectionB,
      sectionC,
      sectionD,
      rawTotal,
      adjustments,
      finalScoreClamped,
      riskProfile
    };
  }

  function updateDisplay(form, scores) {
    const scoreDisplay = document.getElementById("scoreDisplay");
    const profileDisplay = document.getElementById("profileDisplay");
    if (!scoreDisplay || !profileDisplay) return;

    const anyAnswered = form.querySelector('input[type="radio"]:checked, input[type="checkbox"]:checked');

    if (!anyAnswered) {
      scoreDisplay.textContent = "–";
      profileDisplay.textContent = "–";
      return;
    }

    scoreDisplay.textContent = scores.finalScoreClamped;
    profileDisplay.textContent = scores.riskProfile;
  }

  const form = document.getElementById("riskForm");
  if (!form) {
    console.log("riskForm not found");
    return;
  }

  function recalcAndUpdate() {
    const scores = calculateScores(form);
    updateDisplay(form, scores);
  }

  const inputs = form.querySelectorAll("input");
  inputs.forEach(function (input) {
    input.addEventListener("change", recalcAndUpdate);
  });

  recalcAndUpdate();

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const scores = calculateScores(form);
    updateDisplay(form, scores);

    const {
      A1, A2, A3, A4,
      B1, B2, B3, B4,
      C1, C2, C3,
      D1, D2,
      sectionA,
      sectionB,
      sectionC,
      sectionD,
      rawTotal,
      adjustments,
      finalScoreClamped,
      riskProfile
    } = scores;

    const payload = {
      primaryClientName: form.primaryClientName.value,
      coClientName: form.coClientName.value,
      date: form.date.value,
      advisorName: form.advisorName.value,
      questionScores: {
        A1, A2, A3, A4,
        B1, B2, B3, B4,
        C1, C2, C3,
        D1, D2
      },
      sectionScores: {
        sectionA,
        sectionB,
        sectionC,
        sectionD
      },
      rawTotal,
      adjustments,
      finalScore: finalScoreClamped,
      riskProfile,
      adjustmentFlags: {
        ageOver65: form.ageOver65 ? form.ageOver65.checked : false,
        approachingRetirement: form.approachingRetirement ? form.approachingRetirement.checked : false,
        inheritanceWindfall: form.inheritanceWindfall ? form.inheritanceWindfall.checked : false,
        singleIncome: form.singleIncome ? form.singleIncome.checked : false,
        pensionIncome: form.pensionIncome ? form.pensionIncome.checked : false
      }
    };

    try {
      const response = await fetch(FLOW_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        throw new Error("Flow returned status " + response.status);
      }

      alert("Thank you. Your responses have been submitted to your advisor.");
      form.reset();
      recalcAndUpdate();
    } catch (err) {
      console.error("Error sending to Power Automate:", err);
      alert("There was a problem submitting the form. Please try again or contact your advisor.");
    }
  });
});
</script>
</body>
</html>
